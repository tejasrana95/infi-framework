<?phpclass menu {// Menu builder function, parentId 0 is the root    function submenuurl($parent, $menu) {        foreach ($menu['parents'][$parent] as $itemId) {            if (!isset($menu['parents'][$itemId])) {                if ($menu['items'][$itemId]['link'] == "") {                    $html[] = $menu['items'][$itemId]['label'];                } elseif ($menu['items'][$itemId]['link'] == "#") {                    $html[] = links($menu['items'][$itemId]['link']);                } else {                    $html[] = links($menu['items'][$itemId]['link']);                }            }            if (isset($menu['parents'][$itemId])) {                if ($menu['items'][$itemId]['link'] == "") {                                    } elseif ($menu['items'][$itemId]['link'] == "#") {                    $html[] = links($menu['items'][$itemId]['link']);                } else {                    $html[] = links($menu['items'][$itemId]['link']);                }                $html[] = $this->submenuurl($itemId, $menu);            }        }        return $html;    }    public $level = 0;    function buildMenu($parent, $menu) {        global $level;        $html = "";        $current = "current";        $page = getPage();        if (isset($page)) {            $page = URL . $page[0];        } else {            $page = URL;        }        if (isset($menu['parents'][$parent])) {            if ($parent == 0) {                $html .= '<ul class="nav navbar-nav navbar-right">'                        . '';            } else {                $html .= '<ul  class="drop-down level' . $level . '">';            }            foreach ($menu['parents'][$parent] as $itemId) {                if (!isset($menu['parents'][$itemId])) {                    if ($menu['items'][$itemId]['link'] == "") {                        $html .= "<li ><a href='javascript:void(0);'>" . $menu['items'][$itemId]['label'] . "<i class=fa fa-angle-down'></i></a></li>";                    } elseif ($menu['items'][$itemId]['link'] == "#") {                        $html .= "<li><a href='" . links($menu['items'][$itemId]['link']) . "'>" . $menu['items'][$itemId]['label'] . "</a></li>";                    } else {                        $html .= "<li ";                        if (links($menu['items'][$itemId]['link']) == $page) {                            $html .="class='" . $current . "'";                        }                        $html .= " ><a href='" . links($menu['items'][$itemId]['link']) . "'>" . $menu['items'][$itemId]['label'] . "</a></li>";                    }                }                if (isset($menu['parents'][$itemId])) {                    if ($menu['items'][$itemId]['link'] == "") {                        $html .= "<li><a href='javascript:void(0);'>" . $menu['items'][$itemId]['label'] . "</a>";                    } elseif ($menu['items'][$itemId]['link'] == "#") {                        $html .= "<li class='drop'><a href='" . links($menu['items'][$itemId]['link']) . "' class='dropdown-toggle' data-toggle='dropdown' data-hover='dropdown' >" . $menu['items'][$itemId]['label'] . "</a> ";                    } else {                        $html .= "<li class='drop ";                        $submenulinks = ($this->submenuurl($itemId, $menu));                        if (links($menu['items'][$itemId]['link']) == $page) {                            $html .="" . $current . " ";                        } elseif (in_array($page, $submenulinks)) {                            $html .="" . $current . " ";                        }                        $html .="'";                        $html .= "><a href='" . links($menu['items'][$itemId]['link']) . "' class='dropdown-toggle' data-toggle='' data-hover='dropdown'>" . $menu['items'][$itemId]['label'] . "</a>";                    }                    if ($itemId != 0) {                        $sql = new sql();                        $sql->connect();                        $result = $sql->fetch('menu', array("uid" => $itemId), "order by sort asc");                        if ($result['parent'] != 0) {                            $level = 3;                        } else {                            $level = 0;                        }                    }                    $html .= $this->buildMenu($itemId, $menu);                    $html .= "</li> ";                }            }            $html .= "</ul> ";        }        return $html;    }    function menu($parent = NULL) {        $sql = new sql();        $sql->connect();        if ($parent) {            $result = $sql->fetchAll('menu', array("parent" => '0'), "order by sort asc");        } else {            $result = $sql->fetchAll('menu', array("1" => '1'), "order by sort asc");        }        $menu = array(            'items' => array(),            'parents' => array()        );        foreach ($result as $items) {            $menu['items'][$items['uid']] = magicKeyword($items);            $menu['parents'][$items['parent']][] = $items['uid'];        }        //  debug($result,1);        $data = $this->buildMenu(0, $menu);        return $data;    }}